<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[iOS系统数据库的调用]]></title>
      <url>http://59.110.60.152/2016/12/05/iOS%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%B0%83%E7%94%A8/</url>
      <content type="html"><![CDATA[<h1 id="SQLite简介"><a href="#SQLite简介" class="headerlink" title="SQLite简介"></a>SQLite简介</h1><p>SQLite 是一个软件库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。SQLite 是在世界上最广泛部署的 SQL 数据库引擎。SQLite 源代码不受版权限制。 基础数据库语句：<a href="http://%3Chttp://www.runoob.com/sqlite/sqlite-tutorial.html%3E" target="_blank" rel="external">《SQLite菜鸟教程》</a></p>
<p><excerpt in="" index="" |="" 首页摘要=""><br><a id="more"></a></excerpt></p>
<the rest="" of="" contents="" |="" 余下全文="">

<p>Xcode中引入SQLite 首先创建一个项目。<br>接下来引入SQLite，如图:<br><img src="/images/iOS系统数据库的调用-1.png" alt="引入SQLite"> </p>
<p>点开加号<br><img src="/images/iOS系统数据库的调用-2.png" alt="引入SQLite"> </p>
<p>选择一个库点击Add之后，完成后<br><img src="/images/iOS系统数据库的调用-3.png" alt="引入SQLite"><br>至此，SQLite库已经添加完成。</p>
<h1 id="创建打开数据库"><a href="#创建打开数据库" class="headerlink" title="创建打开数据库"></a>创建打开数据库</h1><p>使用 <code>sqlite3_open</code> 方法可以打开数据库，如果没有该文件，则系统会自动创建一个文件，并且打开。</p>
<p>首先引入数据库头文件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"&lt;sqlite.h&gt;"</span></span></div></pre></td></tr></table></figure>
<h2 id="创建数据库路径"><a href="#创建数据库路径" class="headerlink" title="创建数据库路径"></a>创建数据库路径</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//数据库路径</span></div><div class="line"><span class="built_in">NSString</span> *path = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>).firstObject; </div><div class="line"><span class="built_in">NSString</span> *sqlitePath = [path stringByAppendingPathComponent:<span class="string">@"database.sqlite"</span>];</div></pre></td></tr></table></figure>
<h2 id="打开数据库"><a href="#打开数据库" class="headerlink" title="打开数据库"></a>打开数据库</h2><p>先创建一个全局变量，这个变量是数据库打开后返回的一个操作指针，可以使用它来对数据库进行操作</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlite3 *contactDatabase</div></pre></td></tr></table></figure>
<p>打开数据库</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> result = sqlite3_open(sqlitePath.UTF8String, &amp;contactDatabase);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//打开数据库成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//打开数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="创建-amp-删除"><a href="#创建-amp-删除" class="headerlink" title="创建&amp;删除"></a>创建&amp;删除</h1><p><code>sqlite3_exce()</code> 执行一条非查询的语句</p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"CREATE TABLE IF NOT EXISTS student (ID INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, age INTEGER, address TEXT)"</span>;</div><div class="line"><span class="keyword">int</span> result = sqlite3_exec(contactDatabase, sqlString.UTF8String, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//创建数据库成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//创建数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"drop table studets"</span>;</div><div class="line"><span class="keyword">int</span> result = sqlite3_exec(contactDatabase, sqlString.UTF8String, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//删除数据库成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//删除数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="插入-amp-更新-amp-删除"><a href="#插入-amp-更新-amp-删除" class="headerlink" title="插入&amp;更新&amp;删除"></a>插入&amp;更新&amp;删除</h1><p>SQLite可以使用占位符来插入数据</p>
<h2 id="插入数据库-不使用占位符"><a href="#插入数据库-不使用占位符" class="headerlink" title="插入数据库 不使用占位符"></a>插入数据库 不使用占位符</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"INSERT INTO student (NAME, AGE, ADDRESS) VALUES ('%@', %@, '%@')"</span>, <span class="string">@"张三丰"</span>, <span class="string">@"127"</span>, <span class="string">@"北京市"</span>];</div><div class="line"><span class="keyword">int</span> result = sqlite3_exec(contactDatabase, sqlString.UTF8String, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//插入数据库成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//插入数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用占位符，需要用到 <code>sqlite3_prepare_v2</code> 和 <code>sqlite3_bind_text</code> 方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"INSERT INTO student (NAME, AGE, ADDRESS) VALUES (?, ?, ?)"</span>;</div><div class="line">sqlite3_stmt *statement;</div><div class="line"><span class="keyword">int</span> result = sqlite3_prepare_v2(contactDatabase, sqlString.UTF8String, <span class="number">-1</span>, &amp;statement, <span class="literal">NULL</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    sqlite3_bind_text(statement, <span class="number">1</span>, <span class="string">"张三丰"</span>, <span class="number">-1</span>, <span class="literal">nil</span>)</div><div class="line">    sqlite3_bind_int(statement, <span class="number">2</span>, <span class="number">127</span>);</div><div class="line">    sqlite3_bind_text(statement, <span class="number">3</span>, <span class="string">"北京市"</span>, <span class="number">-1</span>, <span class="literal">nil</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (sqlite3_step(statement) == SQLITE_DONE) &#123;</div><div class="line">        <span class="comment">//插入数据库成功</span></div><div class="line">    &#125;</div><div class="line">    sqlite3_finalize(statement);</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//插入数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="更新数据库"><a href="#更新数据库" class="headerlink" title="更新数据库"></a>更新数据库</h2><p>和插入数据库类似，用SQLite的update语句即可</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"UPDATE student SET AGE = 129 WHERE NAME = '张三丰'"</span>;</div><div class="line"><span class="keyword">int</span> result = sqlite3_exec(contactDatabase, sqlString.UTF8String, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//更新数据库成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//更新数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也可使用占位符</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"UPDATE student SET AGE = ? WHERE NAME = ?"</span>;</div><div class="line">sqlite3_stmt *statement;</div><div class="line"><span class="keyword">int</span> result = sqlite3_prepare_v2(contactDatabase, sqlString.UTF8String, <span class="number">-1</span>, &amp;statement, <span class="literal">NULL</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    sqlite3_bind_int(statement, <span class="number">1</span>, <span class="number">129</span>);</div><div class="line">    sqlite3_bind_text(statement, <span class="number">2</span>, <span class="string">"张三丰"</span>, <span class="number">-1</span>, <span class="literal">nil</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (sqlite3_step(statement) == SQLITE_DONE) &#123;</div><div class="line">        <span class="comment">//插入数据库成功</span></div><div class="line">    &#125;</div><div class="line">    sqlite3_finalize(statement);</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//插入数据库失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3.删除数据库</p>
<p>和插入数据库类似，用SQLite的update语句即可</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"DELETE FROM student WHERE NAME = '张三丰'"</span>;</div><div class="line"><span class="keyword">int</span> result = sqlite3_exec(contactDatabase, sqlString.UTF8String, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="comment">//删除成功</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//删除失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *sqlString = <span class="string">@"SELECT * FROM student"</span>;</div><div class="line">sqlite3_stmt *statement;</div><div class="line"><span class="keyword">int</span> result = sqlite3_prepare_v2(contactDatabase, sqlString.UTF8String, <span class="number">-1</span>, &amp;statement, <span class="literal">NULL</span>);</div><div class="line"><span class="keyword">if</span> (result == SQLITE_OK) &#123;</div><div class="line">    <span class="keyword">while</span> (sqlite3_step(statement) == SQLITE_ROW) &#123;</div><div class="line">        <span class="keyword">char</span> *name = (<span class="keyword">char</span> *)sqlite3_column_text(statement, <span class="number">1</span>);</div><div class="line">        <span class="built_in">NSString</span> *nameString = [<span class="built_in">NSString</span> stringWithUTF8String:name];</div><div class="line">        <span class="keyword">int</span> age = sqlite3_column_int(statement, <span class="number">2</span>);</div><div class="line">        <span class="keyword">char</span> *address = (<span class="keyword">char</span> *)sqlite3_column_text(statement, <span class="number">3</span>);</div><div class="line">        <span class="built_in">NSString</span> *addressString = [<span class="built_in">NSString</span> stringWithUTF8String:address];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"name:%@  age:%d  address:%@"</span>, nameString, age, addressString);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">//查询失败</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</the>]]></content>
    </entry>
    
  
  
</search>
